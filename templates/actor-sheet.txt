<form class="flexcol {{cssClass}}" autocomplete="off">
  <header class="sheet-header">
    <img class="profile-img" src="{{data.img}}" data-edit="img" title="{{data.name}}" height="100" width="100" />
    <div class="header-fields">
      <h1 class="charname">
        <input name="name" type="text" value="{{data.name}}" placeholder="Name" />
      </h1>

      <div class="resource">
        <label>Pronouns</label>
        <input type="text" name="system.pronouns" value="{{systemData.pronouns}}" placeholder="she/they"/>
      </div>

      <!-- Paranormal Inc core stats -->
      <div class="stats-grid">
        <div class="stat"><label>Science</label>
          <input type="number" name="system.stats.science" value="{{systemData.stats.science}}"/>
        </div>
        <div class="stat"><label>Wits</label>
          <input type="number" name="system.stats.wits" value="{{systemData.stats.wits}}"/>
        </div>
        <div class="stat"><label>Vigour</label>
          <input type="number" name="system.stats.vigour" value="{{systemData.stats.vigour}}"/>
        </div>
        <div class="stat"><label>Intuition</label>
          <input type="number" name="system.stats.intuition" value="{{systemData.stats.intuition}}"/>
        </div>
      </div>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="description">Description</a>
    <a class="item" data-tab="moves">Moves</a>
    <a class="item" data-tab="items">Items</a>
    <a class="item" data-tab="attributes">Attributes</a>
  </nav>

  <section class="sheet-body">

    <div class="tab description" data-group="primary" data-tab="description">
      {{editor biographyHTML target="system.biography" button=true editable=editable engine="prosemirror"}}
    </div>

    <!-- Moves: displays options; selection handling is done in sheet JS -->
    <div class="tab moves" data-group="primary" data-tab="moves">
      <p><em>Choose 2 moves.</em></p>
      <ol class="move-options">
        {{#each systemData.moves.options as |opt|}}
          <li class="flexcol">
            <label class="flexrow">
              <!-- Sheet JS should toggle presence in system.moves.selected[] -->
              <input type="checkbox" class="pin-move-toggle" data-move="{{opt.key}}"/>
              <strong>{{opt.name.en}}</strong>
            </label>
            <div class="move-text">{{opt.text.en}}</div>
          </li>
        {{/each}}
      </ol>
    </div>

    <div class="tab items" data-group="primary" data-tab="items">
      <ol class="item-list">
        {{#each data.items as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
          <h4 class="item-name">{{item.name}}</h4>

          <div class="item-buttons">
            {{#each item.system.attributes as |itemAttr key|}}
              {{#if itemAttr.dtype}}
                {{#if itemAttr.isFormula}}
                  {{#if ../../shorthand}}
                  <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}" data-label="{{ itemAttr.label }}" title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                  {{else}}
                  <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.attributes.{{key}}.value" data-label="{{ itemAttr.label }}" title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                  {{/if}}
                {{/if}}
              {{else}}
                {{#each itemAttr as |itemGroupedAttr groupedKey|}}
                  {{#if itemGroupedAttr.isFormula}}
                    {{#if ../../../shorthand}}
                    <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}.{{groupedKey}}" data-label="{{ itemGroupedAttr.label }}" title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                    {{else}}
                    <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.attributes.{{key}}.{{groupedKey}}.value" data-label="{{ itemGroupedAttr.label }}" title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                    {{/if}}
                  {{/if}}
                {{/each}}
              {{/if}}
            {{/each}}
          </div>

          <div class="item-controls">
            <a class="item-control" title="{{ localize 'PIN.Item.Edit' }}" data-action="edit"><i class="fas fa-edit"></i></a>
            <a class="item-control" title="{{ localize 'PIN.Item.Delete' }}" data-action="delete"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <p>
        <a class="item-control" title="{{ localize 'PIN.ItemCreate' }}" data-action="create"><i class="fas fa-plus"></i> {{ localize "PIN.Item.Create" }}</a>
      </p>
    </div>

    <div class="tab attributes" data-group="primary" data-tab="attributes">
      <header class="attributes-header flexrow">
        <span class="attribute-key">{{localize "PIN.Attribute.Key"}}</span>
        <span class="attribute-value">{{localize "PIN.Attribute.Value"}}</span>
        <span class="attribute-label">{{localize "PIN.Attribute.Label"}}</span>
        <span class="attribute-dtype">{{localize "PIN.Attribute.Dtype"}}</span>
        <a class="attribute-control" data-action="create" data-group="{{group}}"><i class="fas fa-plus"></i></a>
      </header>

      {{> "systems/paranormal_inc/templates/parts/sheet-attributes.html" attributes=systemData.ungroupedAttributes dtypes=dtypes}}

      <div class="groups">
        {{> "systems/paranormal_inc/templates/parts/sheet-groups.html" attributes=systemData.groupedAttributes groups=systemData.groups dtypes=dtypes}}
        <div class="group-controls flexrow">
          <input class="group-prefix" type="text" value=""/>
          <a class="button group-control" data-action="create-group"><i class="fas fa-plus"></i>Add Attribute Group</a>
        </div>
      </div>
    </div>
  </section>
</form>
